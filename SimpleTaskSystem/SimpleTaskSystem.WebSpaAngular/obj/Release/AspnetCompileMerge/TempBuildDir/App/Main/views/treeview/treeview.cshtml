<script src="~/api/AbpServiceProxies/GetAll?type=angular"></script>
<style>
.btn-main{
    padding:8px;
    margin-bottom: 20px;
}

.btn-options{
    padding:2px;
}

.btn-delete{
    border-radius: 100%;
    width: 25px;
    background-color:red;
}

.main-ul{
    font-size:14px;
}

.child-ul{
    font-size:12px;
}

</style>

<div class="panel panel-default" ng-controller="TreeCtrl as vm">

    <div class="panel-heading" style="position: relative;">
        <div class="row">
            
            <!-- Title -->
            <h3 class="panel-title col-xs-6">
                Tree View
            </h3>
        </div>
    </div>
    
    <button style="margin-left:22px" ng-click="vm.payClick()" type="button" class="btn btn-primary btn-main">+ Novo</button>

    <div class="row">
        <div class="col-xs-6">
            <ul class="main-ul">
                <li ng-repeat="node in vm.nodes" ng-include="'tree_item_renderer.html'"></li>
            </ul>
            <button style="margin-left:22px" ng-click="vm.insertNode()" type="button" class="btn btn-primary btn-main">+ Novo</button>
            <button ng-hide="vm.nodes.length == 0" style="margin-left:22px" ng-click="vm.deleteAll()" type="button" class="btn btn-primary btn-main">Limpar Lista</button>
        </div>
        <div class="col-xs-6">
            <textarea style="resize:none;height:300px;width:500px;margin:20px 20px 0 20px;" ng-model="vm.selectedNode.description"></textarea>

            <button style="float:right;margin: 10px 33px 20px 0;" ng-click="vm.updateNode(vm.selectedNode)" type="button" class="btn btn-primary btn-main">Salvar</button>
        </div>
    </div>
    
    <form>
        <input type="text" placeholder="Credit card number" id="cc_number" value="4012001037141112" />
        <input type="text" placeholder="CVC" id="cc_cvc" value="123" />
        <input type="text" placeholder="Month" id="cc_exp_month" value="12" />
        <input type="text" placeholder="Year" id="cc_exp_year" value="18" />
        <textarea id="public_key">-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAoBttaXwRoI1Fbcond5mS
7QOb7X2lykY5hvvDeLJelvFhpeLnS4YDwkrnziM3W00UNH1yiSDU+3JhfHu5G387
O6uN9rIHXvL+TRzkVfa5iIjG+ap2N0/toPzy5ekpgxBicjtyPHEgoU6dRzdszEF4
ItimGk5ACx/lMOvctncS5j3uWBaTPwyn0hshmtDwClf6dEZgQvm/dNaIkxHKV+9j
Mn3ZfK/liT8A3xwaVvRzzuxf09xJTXrAd9v5VQbeWGxwFcW05oJulSFjmJA9Hcmb
DYHJT+sG2mlZDEruCGAzCVubJwGY1aRlcs9AQc1jIm/l8JwH7le2kpk3QoX+gz0w
WwIDAQAB
-----END PUBLIC KEY-----</textarea>
        <textarea id="encrypted_value"></textarea>
        <input type="text" placeholder="Card Type" id="card_type"/>
        <input type="button" value="encrypt" id="encrypt" />
    </form>

</div>

<script type="text/ng-template" id="tree_item_renderer.html">
    <div style="display:inline-block;margin:6px;height:23px" ng-init="count=0" ng-mouseleave="count = 0" ng-mouseover="count= 1">
        <span ng-hide="node.editing" ng-dblclick="vm.editItem(node)" ng-click="vm.selectedNode = node">{{node.title}}</span>
        <button ng-hide="node.editing || count == 0" style="margin-left:0px;padding: 0px 9px;" ng-click="vm.insertChildNode(node)" type="button" class="btn btn-primary btn-options">+ Subnível</button>
        <button ng-hide="node.editing  || count == 0" style="margin-left:0px;padding: 0;" ng-click="vm.deleteNode(node)" type="button" class="btn btn-primary btn-delete btn-options"> X </button>
        <input ng-show="node.editing" ng-model="node.title" ng-blur="vm.doneEditing(node)" autofocus />
    </div>

    <ul class="child-ul">
        <li ng-repeat="node in node.childNodes" ng-include="'tree_item_renderer.html'"></li>
    </ul>

</script>

<script type="text/javascript">
    $(document).ready(function() {
        $("#encrypt").click(function() {
            var cc = new Moip.CreditCard({
                number  : $("#number").val(),
                cvc     : $("#cvc").val(),
                expMonth: $("#month").val(),
                expYear : $("#year").val(),
                pubKey  : $("#public_key").val()
            });
            console.log(cc);
            if( cc.isValid()){
                $("#encrypted_value").val(cc.hash());
            }
            else{
                $("#encrypted_value").val('');
                alert('Invalid credit card. Verify parameters: number, cvc, expiration Month, expiration Year');
            }
        });
    });
</script>

